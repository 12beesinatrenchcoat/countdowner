(()=>{var J=new Intl.DateTimeFormat(void 0,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit"}),{format:v}=J,q=864e5,D=36e5,A=6e4,z=1e3;function w(e){let t=e<0;e=Math.abs(e);let o=Math.floor(e/q),n=Math.floor(e%q/D),r=Math.floor(e%D/A),a=(Math.floor(e%A/z*100)/100).toFixed(2),s=o?o+"d ":"";return s+=s||n?n+"h ":"",s+=s||r?r+"m ":"",s+=s||a?a+"s ":"",s+=t?" ago":"",s}var H;(H=document.querySelector("#enable-notifications"))==null||H.addEventListener("click",e=>{if(!("Notification"in window)){let t=e.target;t.disabled=!0,t.textContent="this browser does not support desktop notifications."}Notification.requestPermission().then(t=>{t==="granted"&&new Notification("test notification",{body:"if you're seeing this, notifications are now enabled!"})})});var L=document.querySelector("#countdowns"),F=document.querySelector("#current-time"),k=localStorage.getItem("countdowns"),l=k?JSON.parse(k):{};if(l)for(let e of Object.keys(l))h(l[e],!1);function O(){let e=Date.now();F.textContent=v(e);let t=document.querySelectorAll("span.time-left");for(let o of t){let n=l[o.id],a=(n.started?n.endTime:n.startTime)-e,s;n.started?s=n.done?"ended ":"ending in ":s="starting in ",o.textContent=s+w(a);let d=n.done?"100%":(e-n.startTime)/(n.endTime-n.startTime)*100+"%",{parentElement:i}=o;if(i.style.setProperty("--progress",d),n.started=n.started||e>n.startTime,a<=0&&!n.done){console.log(`Countdown ${n.title} done! (ID ${n.startTime})`),n.done=!0;let c=new Notification(n.title,{body:"countdown finished!",timestamp:n.endTime});E()}}setTimeout(O,Number(window.settings["update-rate"]))}setTimeout(O,Number(window.settings["update-rate"]));document.querySelector("#new-timer").addEventListener("click",()=>{let e=Date.now(),t=document.querySelector("#timer-title"),o=document.querySelector("#timer-hours"),n=document.querySelector("#timer-minutes"),r=document.querySelector("#timer-seconds"),a=t.value,s=o.valueAsNumber||0,d=n.valueAsNumber||0,i=r.valueAsNumber||0,c=e+(s*3600+d*60+i)*1e3,u=new S(a,e,c,"timer");h(u)});document.querySelector("#new-event").addEventListener("click",()=>{let e=document.querySelector("#new-event");if(!e.dataset.warning||e.textContent===e.dataset.warning){let t=document.querySelector("#event-title"),o=document.querySelector("#event-start"),n=document.querySelector("#event-end"),r=new Date(o.value),a=new Date(n.value),s=new S(t.value,r.getTime(),a.getTime(),"event");h(s),e.textContent="add event"}e.dataset.warning&&(e.textContent=e.dataset.warning,setTimeout(()=>{e.textContent="add event"},5e3))});function h(e,t=!0){t&&(l[e.startTime]=e,E());let o=document.createElement("div");o.classList.add("countdown",e.type),o.id=String(e.startTime);let n=document.createElement("span");n.className="countdown-header";let r=document.createElement("span");r.className="title-span";let a=document.createElement("h2");a.textContent=e.title,a.className="title";let s=document.createElement("input");s.type="text",s.value=e.title,s.hidden=!0,s.className="title-edit",r.append(a,s);let d=document.createElement("span");d.className="buttons";let i=document.createElement("button");i.textContent="edit",i.className="edit";let c=document.createElement("button");c.textContent="delete",c.className="delete",c.addEventListener("click",()=>{c.textContent==="you sure?"&&(o.remove(),delete l[e.startTime],E()),c.textContent==="delete"&&(c.textContent="you sure?",c.classList.add("danger"),setTimeout(()=>{c.textContent="delete",c.classList.remove("danger")},5e3))}),d.append(i,c),n.append(r,d);let u=document.createElement("span");u.id=String(e.startTime),u.className="time-left",u.textContent=w(e.endTime-Date.now());let y=document.createElement("div");y.className="footer";let p=document.createElement("input");p.type="datetime-local",p.className="start-date-edit",p.hidden=!0;let T=document.createElement("time");T.className="start",T.textContent=`${e.started?"started":"starts"} ${v(e.startTime)}`;let m=document.createElement("input");m.type="datetime-local",m.className="end-date-edit",m.hidden=!0;let f=document.createElement("time");f.className="end",f.textContent=`${e.done?"ended":"ends"} ${v(e.endTime)}`;let C=document.createElement("div");C.append(T,p);let x=document.createElement("div");x.append(f,m),y.append(C,x),o.append(n,u,y),L==null||L.appendChild(o),i.addEventListener("click",()=>{let j=new Date(e.startTime),I=new Date(e.endTime),g=new Date().getTimezoneOffset()*6e4;if(g-=g-I.getTimezoneOffset()*6e4,m.hidden=!m.hidden,f.hidden=!f.hidden,a.hidden=!a.hidden,s.hidden=!s.hidden,i.textContent==="edit")i.textContent="save",s.value=a.textContent||"",p.valueAsNumber=j.getTime()-g,m.valueAsNumber=I.getTime()-g;else{i.textContent="edit",a.textContent=s.value;let M=new Date(p.valueAsNumber).getTime()+g,b=new Date(m.valueAsNumber).getTime()+g;e.startTime=M,e.endTime=b,T.textContent=`${e.started?"started":"starts"} ${v(M)}`,f.textContent=`${e.done?"ended":"ends"} ${v(b)}`,b>Date.now()&&(e.done=!1),E()}})}function E(){let e=JSON.stringify(l);localStorage.setItem("countdowns",e),console.groupCollapsed("saved countdowns!"),console.debug(e),console.groupEnd()}var S=class{constructor(t,o,n,r){let a=Date.now();this.title=t,this.createTime=a,this.startTime=o,this.endTime=n,this.type=r,this.started=a>=o,this.done=a>=n}};for(let e of document.querySelectorAll(".tab"))e.addEventListener("click",()=>{var a,s,d;let t=String(e.getAttribute("href")),o=((s=(a=e.parentElement)==null?void 0:a.parentElement)==null?void 0:s.querySelectorAll(".tab-content"))||[];for(let i of o)i.style.display="none";let n=document.querySelector(t);n?n.style.display="flex":console.error("missing tabContent for "+t);let r=(d=e.parentElement)==null?void 0:d.children;for(let i=0;i<r.length;i++)r[i].classList.remove("selected");e.classList.add("selected")});document.querySelector("#event-start").addEventListener("input",()=>$());document.querySelector("#event-end").addEventListener("input",()=>$());var _=document.querySelector("#new-event");function $(){let e=document.querySelector("#event-start"),t=document.querySelector("#event-end");e.valueAsNumber>t.valueAsNumber?(e.classList.add("invalid"),t.classList.add("invalid"),_.dataset.warning="end date is before start date. you sure?"):(e.classList.remove("invalid"),t.classList.remove("invalid"),delete _.dataset.warning)}for(let e of document.querySelectorAll("#settings > label > input"))e.addEventListener("input",()=>{var t,o;window.settings[e.name]=(o=(t=e.valueAsNumber)!=null?t:e.checked)!=null?o:e.value}),e.addEventListener("change",()=>{let t=JSON.stringify(window.settings);localStorage.setItem("settings",t),console.groupCollapsed("saved settings!"),console.debug(t),console.groupEnd()});window.settings=JSON.parse(localStorage.getItem("settings")||"{}");for(let e of Object.keys(window.settings)){let t=document.querySelector("input[name="+e+"]");if(!t)break;t.value=String(window.settings[e]),t.type==="range"&&N(t),B(t.name,t.value)}for(let e of document.querySelectorAll("#settings > label > input"))e.addEventListener("input",()=>{B(e.name,e.value)});function B(e,t){for(let o of document.querySelectorAll("."+e+"-output"))o.textContent=t}for(let e of document.querySelectorAll("input[type='range']"))e.addEventListener("input",()=>N(e)),N(e);function N(e){let t=Number(e.min),o=Number(e.max),n=e.valueAsNumber;e.style.backgroundSize=String((n-t)*100/(o-t))+"% 100%"}})();
